<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Test de Códigos</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: Arial; padding: 20px; }
        button { padding: 10px 20px; margin: 10px; cursor: pointer; border: none; border-radius: 8px; }
        .success { color: green; }
        .error { color: red; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; }
        .btn-back { background: #3498db; color: white; float: right; }
    </style>
</head>
<body>
    <button onclick="window.location.href='admin.html'" class="btn-back">
        <i class="fas fa-arrow-left"></i> Volver al Panel Admin
    </button>
    <h1>Test de Sistema de Códigos</h1>
    
    <h2>1. Generar Código</h2>
    <button onclick="generarCodigo()">Generar 1 Código</button>
    <div id="codigo-generado"></div>
    
    <h2>2. Ver Códigos en localStorage</h2>
    <button onclick="verCodigos()">Ver Códigos</button>
    <pre id="codigos-lista"></pre>
    
    <h2>3. Probar Validación</h2>
    <input type="text" id="codigo-test" placeholder="Ingresa código" style="padding: 10px; width: 200px;">
    <button onclick="validarCodigo()">Validar</button>
    <div id="resultado-validacion"></div>
    
    <h2>4. Limpiar Todo</h2>
    <button onclick="limpiar()" style="background: red; color: white;">Limpiar localStorage</button>

    <script>
        function generarCodigoUnico() {
            const caracteres = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let codigo = '';
            
            for (let i = 0; i < 8; i++) {
                if (i === 4) codigo += '-';
                codigo += caracteres.charAt(Math.floor(Math.random() * caracteres.length));
            }
            
            return codigo;
        }

        function generarCodigo() {
            const codigo = generarCodigoUnico();
            const codigosDisponibles = JSON.parse(localStorage.getItem('codigosAccesoDisponibles')) || [];
            
            const nuevoCodigo = {
                codigo: codigo,
                fechaGeneracion: new Date().toISOString(),
                usado: false,
                fechaUso: null
            };
            
            codigosDisponibles.push(nuevoCodigo);
            localStorage.setItem('codigosAccesoDisponibles', JSON.stringify(codigosDisponibles));
            
            document.getElementById('codigo-generado').innerHTML = `
                <div class="success">
                    <h3>✅ Código Generado:</h3>
                    <h2 style="font-family: monospace; letter-spacing: 3px;">${codigo}</h2>
                    <p>Copia este código y úsalo en el registro</p>
                </div>
            `;
            
            console.log('Código generado:', codigo);
            console.log('Guardado en localStorage');
        }

        function verCodigos() {
            const codigos = JSON.parse(localStorage.getItem('codigosAccesoDisponibles')) || [];
            document.getElementById('codigos-lista').textContent = JSON.stringify(codigos, null, 2);
            console.log('Códigos en localStorage:', codigos);
        }

        function validarCodigo() {
            const codigoInput = document.getElementById('codigo-test').value.trim().toUpperCase();
            const codigosDisponibles = JSON.parse(localStorage.getItem('codigosAccesoDisponibles')) || [];
            
            console.log('Código a validar:', codigoInput);
            console.log('Códigos disponibles:', codigosDisponibles);
            
            const codigoValido = codigosDisponibles.find(c => c.codigo === codigoInput && !c.usado);
            
            const resultado = document.getElementById('resultado-validacion');
            if (codigoValido) {
                resultado.innerHTML = '<div class="success"><h3>✅ Código VÁLIDO</h3><p>Este código puede usarse para registro</p></div>';
                console.log('✅ Código válido encontrado:', codigoValido);
            } else {
                resultado.innerHTML = '<div class="error"><h3>❌ Código INVÁLIDO</h3><p>El código no existe o ya fue usado</p></div>';
                console.log('❌ Código no encontrado o ya usado');
            }
        }

        function limpiar() {
            if (confirm('¿Eliminar todos los códigos?')) {
                localStorage.removeItem('codigosAccesoDisponibles');
                document.getElementById('codigos-lista').textContent = 'localStorage limpio';
                document.getElementById('codigo-generado').innerHTML = '';
                document.getElementById('resultado-validacion').innerHTML = '';
                alert('✅ localStorage limpiado');
            }
        }

        // Cargar códigos al inicio
        window.onload = function() {
            verCodigos();
        };
    </script>
</body>
</html>
